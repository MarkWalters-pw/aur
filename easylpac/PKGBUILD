# Maintainer: 1ridic <i at 8f dot al>
pkgname=easylpac
pkgver=0.7.6.2
pkgrel=1
pkgdesc="lpac GUI Frontend"
arch=('x86_64')
url="https://github.com/creamlike1024/EasyLPAC"
license=('MIT')
makedepends=('go')
depends=('lpac')
provides=("easylpac")
conflicts=("easylpac")
source=(
  easylpac-$pkgver.tar.gz::https://github.com/creamlike1024/EasyLPAC/archive/refs/tags/$pkgver.tar.gz
)
sha256sums=('09f1016230f1f95e619581e6705140f0191d308e37c1035c448f9ef3c82e67b0')

build() {
  cd $srcdir/EasyLPAC-$pkgver
  VERSION=$(grep 'Version' FyneApp.toml | sed 's/Version = "\(.*\)"/\1/' | xargs)
  DATE=$(TZ=Asia/Shanghai date +"%Y-%m-%d")
  sed -i "s/const Version = \"development\"/const Version = \"$VERSION\"/" main.go
  sed -i "s/const EUICCDataVersion = \"unknown\"/const EUICCDataVersion = \"$DATE\"/" main.go
  go generate
  go run fyne.io/fyne/v2/cmd/fyne@latest package --icon assets/icon128.png --release
  
}

package() {
  cd $srcdir/EasyLPAC-$pkgver
  tar xf EasyLPAC.tar.xz
  install -Dm644 usr/local/share/applications/EasyLPAC.desktop $pkgdir/usr/share/applications/EasyLPAC.desktop
  install -Dm755 usr/local/bin/EasyLPAC $pkgdir/usr/bin/EasyLPAC
  install -Dm644 usr/local/share/pixmaps/EasyLPAC.png $pkgdir/usr/share/pixmaps/EasyLPAC.png
}
